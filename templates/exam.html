<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Exam Page</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/exam.css') }}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" />
</head>

<body>
  <header>
    <h1>Exam Page (Student)</h1>

    {% if session.get('email') %}
    <div class="user-info">
      ðŸ‘¤ {{ session.get('email') }}
    </div>
    {% endif %}
  </header>

  <main class="container" id="exam-form">
    <p class="instructions">
      Click <strong>Start Exam</strong> to begin. Your camera will turn on automatically.
    </p>

    <!-- Shows violation when tab-switching occurs -->
    <div id="focusWarning" style="color:red; font-weight:600; margin-bottom:10px; display:none;"></div>

    <div id="violationDisplay" style="color:red; font-weight:600;"></div>

    <div class="video-box">
      <video id="webcam" autoplay playsinline muted></video>
    </div>

    <!-- Hidden canvas for frame capture -->
    <canvas id="frameCanvas" width="640" height="480" style="display:none;"></canvas>

    <p class="status">Monitoring will start when you proceed.</p>

    <!-- Start exam button -->
    <button id="proceedBtn">Start Exam</button>

    <!-- Preview Camera Button -->
    <button id="previewBtn">Preview Camera</button>
  </main>

  <footer>
    &copy; 2025 AI Proctoring System. All rights reserved.
  </footer>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script src="{{ url_for('static', filename='js/exam.js') }}"></script>

  <!-- ------------------------------ -->
  <!--  EXTRA: Ensure protections run if quiz page includes this file too -->
  <!-- ------------------------------ -->
  <script>
    // Small helper: if exam_active is set and this page is the quiz,
    // the exam.js protections (which rely on localStorage flags) will keep working.
    // We use the same endpoint name used in app.py: /tab-violation
    function notifyTabViolationQuick(reason) {
      fetch("/tab-violation", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ peerId: localStorage.getItem("exam_peer_id") || null, reason })
      }).catch(() => {});
    }

    // If the user navigated back to exam.html while exam_active, re-request fullscreen
    if (localStorage.getItem("exam_active") === "1") {
      try {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch(()=>{});
        }
      } catch(e){}
    }
  </script>

</body>
</html>
